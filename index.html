<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Snake - 12 Niveles</title>
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            padding: 10px;
            background: #0d1117;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: background 0.5s ease;
            overflow-x: hidden;
        }

        body.level-1 { background: #0d1117; }
        body.level-2 { background: linear-gradient(135deg, #1a1e2e 0%, #2d1b4e 100%); }
        body.level-3 { background: linear-gradient(135deg, #0f2027 0%, #203a43 100%); }
        body.level-4 { background: linear-gradient(135deg, #1a2a3a 0%, #2e4053 100%); }
        body.level-5 { background: linear-gradient(135deg, #2c1a3e 0%, #4a2c5e 100%); }
        body.level-6 { background: linear-gradient(135deg, #1b2838 0%, #2a3f54 100%); }
        body.level-7 { background: linear-gradient(135deg, #1e1e2e 0%, #3a2e4e 100%); }
        body.level-8 { background: linear-gradient(135deg, #2d1f3d 0%, #4a3060 100%); }
        body.level-9 { background: linear-gradient(135deg, #1f2833 0%, #0b0c10 100%); }
        body.level-10 { background: linear-gradient(135deg, #16213e 0%, #0f3460 100%); }
        body.level-11 { background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%); }
        body.level-12 { background: linear-gradient(135deg, #141e30 0%, #243b55 100%); }

        @media (min-width: 769px) {
            body {
                padding: 30px;
            }
            
            .container {
                padding: 40px;
            }
            
            .grid-container {
                padding: 20px;
            }
        }

        .container {
            background: rgba(22, 27, 34, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(48, 54, 61, 0.5);
            max-width: 1400px;
            width: 100%;
        }

        h1 {
            color: #c9d1d9;
            text-align: center;
            margin: 0 0 20px 0;
            font-size: clamp(1.2rem, 4vw, 2rem);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .grid-container {
            display: flex;
            justify-content: center;
            padding: 10px;
            background: #0d1117;
            border-radius: 6px;
            border: 1px solid #21262d;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(var(--cols, 52), 12px);
            grid-gap: 4px;
            margin: 0 auto;
            padding: 8px;
            background: #0d1117;
            border-radius: 6px;
        }

        .cell {
            width: 12px;
            height: 12px;
            border-radius: 2px;
            background: #161b22;
            border: 1px solid #21262d;
            transition: all 0.3s ease;
        }

        .cell.snake {
            background: #39d353 !important;
            border-color: #39d353 !important;
            box-shadow: 0 0 8px rgba(57, 211, 83, 0.5);
            transform: scale(1.05);
        }

        .cell.food {
            background: #da3af4 !important;
            border-color: #da3af4 !important;
            box-shadow: 0 0 12px rgba(218, 58, 244, 0.6);
            transform: scale(1.05);
            animation: pulse 0.8s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1.05);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.9;
            }
        }

        .level-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(13, 17, 23, 0.98);
            border: 2px solid #39d353;
            color: #c9d1d9;
            padding: 30px 50px;
            border-radius: 6px;
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: bold;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8), 0 0 20px rgba(57, 211, 83, 0.3);
            z-index: 1000;
            animation: popIn 0.3s ease-out;
            pointer-events: none;
            max-width: 90%;
        }

        .level-notification small {
            display: block;
            font-size: clamp(0.8rem, 3vw, 1rem);
            margin-top: 10px;
            opacity: 0.9;
            color: #7ee787;
        }

        .level-notification.fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            0% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        .controls {
            text-align: center;
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        button {
            background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
            color: #ffffff;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: clamp(0.9rem, 3vw, 1rem);
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            touch-action: manipulation;
            user-select: none;
            font-weight: 600;
        }

        button:hover {
            background: linear-gradient(135deg, #2ea043 0%, #3fb950 100%);
            box-shadow: 0 6px 20px rgba(46, 160, 67, 0.4);
        }

        button:active {
            transform: scale(0.95);
        }

        /* Controles t√°ctiles para m√≥viles */
        .touch-controls {
            display: none; /* Oculto por defecto, se mostrar√° con JS solo en m√≥viles */
            margin-top: 20px;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .touch-controls.show-mobile {
            display: block;
        }

        .touch-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 80px);
            gap: 10px;
        }

        .touch-btn {
            background: #21262d;
            border: 1px solid #30363d;
            border-radius: 6px;
            color: #7ee787;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            touch-action: manipulation;
        }

        .touch-btn:active {
            background: #30363d;
            border-color: #39d353;
            transform: scale(0.95);
        }

        .touch-btn-up {
            grid-column: 2;
            grid-row: 1;
        }

        .touch-btn-left {
            grid-column: 1;
            grid-row: 2;
        }

        .touch-btn-right {
            grid-column: 3;
            grid-row: 2;
        }

        .touch-btn-down {
            grid-column: 2;
            grid-row: 3;
        }

        .info {
            color: #c9d1d9;
            text-align: center;
            margin-top: 15px;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            opacity: 0.9;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .keyboard-info {
            display: block;
        }

        .stats {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            background: rgba(22, 27, 34, 0.8);
            border: 1px solid #21262d;
            padding: 8px 15px;
            border-radius: 6px;
            font-weight: 600;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            color: #7ee787;
        }

        /* Media queries para m√≥viles */
        @media (max-width: 768px) {
            body {
                padding: 3px;
            }

            .container {
                padding: 10px;
                border-radius: 15px;
            }

            h1 {
                margin-bottom: 10px;
                font-size: 1.3rem;
            }

            .grid-container {
                padding: 5px;
            }

            button {
                padding: 8px 15px;
                font-size: 0.9rem;
            }

            .controls {
                gap: 8px;
                margin-top: 10px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 2px;
            }

            .container {
                padding: 8px;
            }

            h1 {
                font-size: 1.1rem;
                margin-bottom: 8px;
            }

            .grid-container {
                padding: 3px;
            }

            .touch-grid {
                grid-template-rows: repeat(3, 70px);
            }

            .touch-btn {
                font-size: 1.5rem;
            }
        }

        @media (max-width: 400px) {
            body {
                padding: 2px;
            }

            .container {
                padding: 6px;
            }

            h1 {
                font-size: 1rem;
            }

            .grid-container {
                padding: 2px;
            }
        }

        /* Landscape m√≥vil */
        @media (max-width: 900px) and (orientation: landscape) {
            body {
                padding: 5px;
            }

            .container {
                padding: 10px;
            }

            h1 {
                font-size: 1.2rem;
                margin-bottom: 10px;
            }

            .grid-container {
                padding: 5px;
            }

            .info {
                margin-top: 10px;
            }

            .stats {
                gap: 5px;
            }

            .stat-item {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

            .touch-controls {
                margin-top: 10px;
                max-width: 250px;
            }

            .touch-grid {
                grid-template-rows: repeat(3, 60px);
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Snake Game - Nivel <span id="level-display">1</span>/12</h1>
        <div class="grid-container">
            <div class="grid" id="grid"></div>
        </div>
        <div class="controls">
            <button onclick="startGame()">‚ñ∂Ô∏è Jugar</button>
            <button onclick="pauseGame()">‚è∏Ô∏è Pausar</button>
            <button onclick="resetGame()">üîÑ Reiniciar</button>
        </div>

        <!-- Controles t√°ctiles para m√≥viles -->
        <div class="touch-controls">
            <div class="touch-grid">
                <div class="touch-btn touch-btn-up" data-direction="up">‚¨ÜÔ∏è</div>
                <div class="touch-btn touch-btn-left" data-direction="left">‚¨ÖÔ∏è</div>
                <div class="touch-btn touch-btn-right" data-direction="right">‚û°Ô∏è</div>
                <div class="touch-btn touch-btn-down" data-direction="down">‚¨áÔ∏è</div>
            </div>
        </div>

        <div class="info">
            <span class="keyboard-info">üéÆ Usa las flechas del teclado: ‚¨ÜÔ∏è ‚¨áÔ∏è ‚¨ÖÔ∏è ‚û°Ô∏è</span>
            <span class="mobile-info"></span>
            <div class="stats">
                <div class="stat-item">üìä Puntos: <span id="score">0</span></div>
                <div class="stat-item">üêç Longitud: <span id="length">4</span></div>
                <div class="stat-item">üçé Comidas: <span id="eaten">0</span></div>
            </div>
        </div>
    </div>

    <script>
        let ROWS = 7;
        let COLS = 52;
        const MAX_LEVEL = 12;
        const FOODS_PER_LEVEL = 10;
        
        let grid = [];
        let snake = [];
        let food = null;
        let isPlaying = false;
        let gameInterval;
        let currentDirection = 'right';
        let nextDirection = 'right';
        let score = 0;
        let eatenCount = 0;
        let currentLevel = 1;
        let foodsEatenInLevel = 0;
        let gameSpeed = 150;

        const LEVEL_SPEEDS = {
            1: 150, 2: 135, 3: 120, 4: 105, 5: 90, 6: 80,
            7: 70, 8: 60, 9: 50, 10: 45, 11: 40, 12: 35
        };

        function initGrid() {
            const gridElement = document.getElementById('grid');
            gridElement.innerHTML = '';
            grid = [];
            
            // Calcular el ancho disponible (restando padding del contenedor)
            const containerWidth = window.innerWidth - 70; // 70px = padding total aproximado
            
            // Ajustar columnas y tama√±o seg√∫n el ancho de pantalla
            let cellSize;
            let gap = 4; // Espaciado tipo GitHub contributions
            
            if (window.innerWidth <= 400) {
                COLS = 40;
                gap = 3;
            } else if (window.innerWidth <= 480) {
                COLS = 45;
                gap = 3;
            } else if (window.innerWidth <= 768) {
                COLS = 50;
                gap = 4;
            } else if (window.innerWidth <= 1200) {
                COLS = 52;
                gap = 4;
            } else {
                // Pantallas grandes (desktop)
                COLS = 60;
                gap = 4;
            }
            
            // Calcular el tama√±o de celda para aprovechar el m√°ximo ancho
            cellSize = Math.floor((containerWidth - (gap * (COLS - 1)) - 16) / COLS); // -16 para padding del grid
            
            // Establecer l√≠mites de tama√±o seg√∫n el dispositivo
            if (window.innerWidth > 768) {
                // Desktop: celdas m√°s grandes
                if (cellSize < 10) cellSize = 10;
                if (cellSize > 18) cellSize = 18;
            } else {
                // M√≥vil: celdas m√°s peque√±as
                if (cellSize < 6) cellSize = 6;
                if (cellSize > 12) cellSize = 12;
            }
            
            // Actualizar las variables CSS din√°micamente
            gridElement.style.setProperty('--cols', COLS);
            gridElement.style.gridTemplateColumns = `repeat(${COLS}, ${cellSize}px)`;
            gridElement.style.gridGap = `${gap}px`;

            for (let i = 0; i < ROWS; i++) {
                grid[i] = [];
                for (let j = 0; j < COLS; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.style.width = `${cellSize}px`;
                    cell.style.height = `${cellSize}px`;
                    gridElement.appendChild(cell);
                    grid[i][j] = {
                        element: cell,
                        hasSnake: false,
                        hasFood: false
                    };
                }
            }
        }

        function initSnake() {
            snake = [
                { row: 3, col: 0 },
                { row: 3, col: 1 },
                { row: 3, col: 2 },
                { row: 3, col: 3 }
            ];
            currentDirection = 'right';
            nextDirection = 'right';
            
            snake.forEach(pos => {
                grid[pos.row][pos.col].hasSnake = true;
                grid[pos.row][pos.col].element.classList.add('snake');
            });
        }

        function spawnFood() {
            if (food) {
                grid[food.row][food.col].hasFood = false;
                grid[food.row][food.col].element.classList.remove('food');
            }

            let emptyPositions = [];
            for (let i = 0; i < ROWS; i++) {
                for (let j = 0; j < COLS; j++) {
                    if (!grid[i][j].hasSnake) {
                        emptyPositions.push({ row: i, col: j });
                    }
                }
            }

            if (emptyPositions.length === 0) {
                gameOver('¬°Ganaste! Completaste el juego üèÜ', true);
                return;
            }

            const randomIndex = Math.floor(Math.random() * emptyPositions.length);
            food = emptyPositions[randomIndex];
            
            grid[food.row][food.col].hasFood = true;
            grid[food.row][food.col].element.classList.add('food');
        }

        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('eaten').textContent = eatenCount;
            document.getElementById('length').textContent = snake.length;
            document.getElementById('level-display').textContent = currentLevel;
        }

        function levelUp() {
            if (currentLevel >= MAX_LEVEL) {
                gameOver('¬°Completaste todos los 12 niveles! üéâüèÜ', true);
                return;
            }

            currentLevel++;
            foodsEatenInLevel = 0;
            
            // Cambiar color de fondo
            document.body.className = `level-${currentLevel}`;
            
            // Mostrar notificaci√≥n visual sin pausar
            showLevelNotification();
            
            // Ajustar velocidad despu√©s de un breve momento
            setTimeout(() => {
                gameSpeed = LEVEL_SPEEDS[currentLevel];
                // Reiniciar el intervalo con la nueva velocidad
                if (isPlaying) {
                    clearInterval(gameInterval);
                    gameInterval = setInterval(moveSnake, gameSpeed);
                }
            }, 500);
            
            updateStats();
        }
        
        function showLevelNotification() {
            const notification = document.createElement('div');
            notification.className = 'level-notification';
            notification.innerHTML = `üéä ¬°NIVEL ${currentLevel}! üéä<br><small>‚ö° M√°s r√°pido</small>`;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => notification.remove(), 500);
            }, 2000);
        }

        function handleDirection(direction) {
            if (!isPlaying) return;
            
            const validMove = {
                'up': currentDirection !== 'down',
                'down': currentDirection !== 'up',
                'left': currentDirection !== 'right',
                'right': currentDirection !== 'left'
            };

            if (validMove[direction]) {
                nextDirection = direction;
            }
        }

        // Controles de teclado
        document.addEventListener('keydown', (e) => {
            const keyMap = {
                'ArrowUp': 'up',
                'ArrowDown': 'down',
                'ArrowLeft': 'left',
                'ArrowRight': 'right'
            };

            if (keyMap[e.key]) {
                handleDirection(keyMap[e.key]);
                e.preventDefault();
            }
        });

        // Controles t√°ctiles
        document.querySelectorAll('.touch-btn').forEach(btn => {
            btn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const direction = btn.getAttribute('data-direction');
                handleDirection(direction);
            });

            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const direction = btn.getAttribute('data-direction');
                handleDirection(direction);
            });
        });

        function getNextPosition(current, direction) {
            let next = { ...current };
            
            switch (direction) {
                case 'right': next.col++; break;
                case 'down': next.row++; break;
                case 'left': next.col--; break;
                case 'up': next.row--; break;
            }
            
            return next;
        }

        function isOutOfBounds(pos) {
            return pos.row < 0 || pos.row >= ROWS || pos.col < 0 || pos.col >= COLS;
        }

        function collidesWithSelf(pos) {
            return snake.some((segment, index) => 
                index < snake.length - 1 && segment.row === pos.row && segment.col === pos.col
            );
        }

        function moveSnake() {
            const head = snake[snake.length - 1];
            currentDirection = nextDirection;
            const next = getNextPosition(head, currentDirection);
            
            if (isOutOfBounds(next)) {
                gameOver('¬°Chocaste con el borde! üí•');
                return;
            }
            
            if (collidesWithSelf(next)) {
                gameOver('¬°Te mordiste la cola! üêç');
                return;
            }
            
            snake.push(next);
            grid[next.row][next.col].hasSnake = true;
            grid[next.row][next.col].element.classList.add('snake');
            
            let ateFood = false;
            if (food && next.row === food.row && next.col === food.col) {
                ateFood = true;
                score += currentLevel * 10;
                eatenCount++;
                foodsEatenInLevel++;
                
                grid[food.row][food.col].hasFood = false;
                grid[food.row][food.col].element.classList.remove('food');
                
                spawnFood();
                
                if (foodsEatenInLevel >= FOODS_PER_LEVEL) {
                    levelUp();
                }
                
                updateStats();
            }
            
            if (!ateFood) {
                const tail = snake.shift();
                grid[tail.row][tail.col].hasSnake = false;
                grid[tail.row][tail.col].element.classList.remove('snake');
            } else {
                updateStats();
            }
        }

        function gameOver(message, isWin = false) {
            pauseGame();
            setTimeout(() => {
                const emoji = isWin ? 'üèÜ' : 'üòµ';
                const levelMsg = isWin ? `\nüéñÔ∏è Nivel alcanzado: ${currentLevel}/${MAX_LEVEL}` : `\nüìä Llegaste al nivel: ${currentLevel}/${MAX_LEVEL}`;
                alert(`${emoji} ${message}${levelMsg}\n\nüéØ Puntos totales: ${score}\nüêç Longitud final: ${snake.length}\nüçé Comidas totales: ${eatenCount}`);
            }, 300);
        }

        function startGame() {
            if (!isPlaying) {
                isPlaying = true;
                gameInterval = setInterval(moveSnake, gameSpeed);
            }
        }

        function pauseGame() {
            isPlaying = false;
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
        }

        function resetGame() {
            pauseGame();
            currentLevel = 1;
            score = 0;
            eatenCount = 0;
            foodsEatenInLevel = 0;
            gameSpeed = LEVEL_SPEEDS[1];
            document.body.className = 'level-1';
            initGrid();
            initSnake();
            spawnFood();
            updateStats();
        }

        window.onload = function() {
            // Detectar si es un dispositivo m√≥vil real
            const isMobile = /iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);
            
            // Mostrar controles t√°ctiles solo en dispositivos m√≥viles
            if (isMobile || (isTouchDevice && window.innerWidth <= 768)) {
                document.querySelector('.touch-controls').classList.add('show-mobile');
                document.querySelector('.keyboard-info').style.display = 'none';
            }
            
            document.body.className = 'level-1';
            initGrid();
            initSnake();
            spawnFood();
            updateStats();
            
            const controls = (isMobile || (isTouchDevice && window.innerWidth <= 768)) ? 
                'üì± Usa los botones t√°ctiles para moverte' : 
                '‚¨ÜÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è Usa las flechas para moverte';
            
            alert(`üéÆ ¬°SNAKE GAME - 12 NIVELES!\n\n${controls}\nüçé Come la comida para crecer\nüìà Come 10 alimentos por nivel\n‚ö° Cada nivel es m√°s r√°pido\nüé® Los colores cambian en cada nivel\n\n¬°Presiona JUGAR para comenzar!`);
        };

        // Recalcular grid al cambiar orientaci√≥n o tama√±o
        let resizeTimer;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(() => {
                if (!isPlaying) {
                    resetGame();
                }
            }, 250);
        });
    </script>
</body>
</html>